version=$1
if [ -z "$node" -o -z "$version" ]; then
  echo "Usage: do-upgrade.sh <version>"
  echo "  version: 2016.2.0"
  exit 1
fi
shift

cd /pe_builds
PLATFORM_STRING='<%=platform_string%>'
BUILD=$(ls -d puppet-enterprise-${version?}-*-${PLATFORM_STRING?}* | tail -n1)
if [ -z "$BUILD" ]; then
  BUILD="puppet-enterprise-${version?}-${PLATFORM_STRING?}"
fi
BUILD=${BUILD%.tar.gz}
cd "$BUILD"

./puppet-enterprise-installer "$@" 2>&1 | tee /vagrant/debug.log

echo "** Installer exited with code: ${PIPESTATUS[0]}"
